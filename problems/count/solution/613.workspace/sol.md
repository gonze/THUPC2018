#solution of count
考虑如何判定一个图是不是合法的.
lemma1:任何一个不连通图的补图是连通图.
证明:显然.
lemma2:若一个图是合法的,当且仅当它是若干个合法的联通块,或者它的补图是若干个合法的联通块.
证明:当这个图是联通的,它如果要合法肯定要取补图然后递归;当这个图不连通,那肯定是直接递归,因为取补图会变成联通图.
至此可以判断一个图是否合法.
可以发现,除了$n=1$的特殊情况,其他时候答案都是偶数,因为一个不联通的合法图的补图是一个连通的合法图.
称这一对为一组合法的图.
可以发现,一组合法的图可以唯一对应一个没有枝节点的有根树(枝节点指出度为1的节点).
这棵树根节点的每一个子树表示它的递归定义(所以要求没有枝节点).
***
进一步发现,一个具有$n$个叶子的没有枝节点的有根树和一组$n$个点的合法图一一对应.
到这一步就有一个自然的dp.
设$f[i][j]$为叶子数为i子树大小最大为j的方案数,转移时需要注意考虑边界情况以及相同大小的子树判重问题.
转移伪代码如下:
```
for i=1 to n do
for j=0 to n do
{
	if (j==0) f[i][j]=0;
	else if ((i==1)&&(j==1)) f[i][j]=1;
	else if (j>=i) f[i][j]=f[i][j-1];
	else
	{
		f[i][j]=f[i][j-1];
		for k=1 to i/j do //枚举大小为j的子树有几个
		{
			if (k*j=i) f[i][j]+=(k!=1)*C(f[j][j],k);
			else f[i][j]+=f[i-k*j][j-1]*(1+((i-k*j)<j))-((i-k*j==1)&&(j-1))*C(f[j][j],k)
		}
	}
}
```
优化求组合数后复杂度$O(n^2logn)$,不能通过数据范围.
可以发现,这种dp状态的转移的边界情况众多,非常不利于优化,考虑把这个dp从按行转移转化为按列转移.
***
设$f[i][j]$为子树大小最大为i的叶子数量一共为j的**树或森林**方案数,这里的**树或森林**的说法主要就是为了简化边界的判定,对于$n\geq 2$时,方案数是原来的2倍,当$n=1$时,方案数为1.
不妨认为$f[i]$是一个多项式,转移方程为$f[i]=f[i-1]*g$,其中$g[j]=[j\%i==0]*C(f[i-1][i]+j/i-1,j/i)$.
伪代码如下:
```
for i=0 to n do f[1][i]=1;
for i=2 to n do
{
	var g[];
	for j=0 to n do if (j mod i==0) g[j]=C(f[i-1][i]+j/i-1,j/i);
	for j=0 to n do for k=0 to n do f[i][j+k]=f[i][j+k]+f[i-1][j]*g[k];
}
```
虽然复杂度同样是$O(n^2logn)$,但明显好看了很多(雾).
***
我们定义原数列的生成函数为$f(x)=a_0+a_1x+a_2x^2+a_3x^3+...$,同时假定$a_0=0$.
这个数列的生成函数就是$a=1+x+2*\sum_{k>1} a_k x^k$,dp的转移等价于如下的式子:
$\prod_{k>0} 1/(1-x^k)^{a_k} = 1+x+2*\sum_{k>1} a_k x^k$
这个地方验题人觉得不是特别显然,那就来解释一下:
右边的部分就是**树或森林**方案数,每一项是$a[]$的两倍,其中$x=0,1$时为1.
左边的每一项展开式就是卷上去的每一个$g[]$.
推一发式子:
$
\prod_{k>0} 1/(1-x^k)^{a_k} = 1+x+2*\sum_{k>1} a_k x^k\dots两边取ln\\
-\sum_{k>0}a_k\ln (1-x^k)=\ln (1+x+2\sum_{k>1}a_k x^k)\\
\sum_{k>0}(a_k\sum_{j>0}\frac{x^{jk}}{j})=\ln (1+x+2\sum_{k>1}a_k x^k)\\
\sum_{k>0}\sum_{j|k}(\frac{a_{k/j}}{j}x^{k})=\ln (1+x+2\sum_{k>1}a_k x^k)\\
\sum_{k>0}\sum_{j|k}(\frac{a_{j}}{k/j}x^{k})=\ln (1+x+2\sum_{k>1}a_k x^k)\\
\sum_{k>0}\sum_{j|k}(\frac{ja_{j}}{k}x^{k})=\ln (1+x+2\sum_{k>1}a_k x^k)\\
\sum_{k>0}\frac{x^k}{k}\sum_{j|k}ja_{j}=\ln (1+x+2\sum_{k>1}a_k x^k)\\
\sum_{k>0}x^k(a_k+\frac{1}{k}\sum_{j|k, j < k}ja_{j})=\ln (1+x+2\sum_{k>1}a_k x^k)\dots两边求导乘x\\
\sum_{k>0}x^k(ka_k+\sum_{j|k, j < k}ja_{j})=\frac{x+2\sum_{k>1}k a_k x^k}{1+x+2\sum_{k>1}a_k x^k}\\
\sum_{k>0}x^kka_k+\sum_{k>0}x^k\sum_{j|k, j < k}ja_{j}=\frac{x+2\sum_{k>1}k a_k x^k}{1+x+2\sum_{k>1}a_k x^k}\\
$
***
定义多项式$R(x)=\sum_{k>0}x^kka_k$,$Q(x)=\sum_{k>0}x^k\sum_{j|k, j < k}ja_{j}$
,$P(x)=R(x)+Q(x)$,$(r_0=q_0=p_0=0)$.
把上面这个式子抄下来:
$
P(x)=\frac{-x+2R(x)}{1-x+2A(x)}\\
(1-x+2A(x))P(x)=-x+2R(x)\\
P(x)+(-x+2A(x))P(x)=-x+2R(x)\\
Q(x)+R(x)+(-x+2A(x))P(x)=-x+2R(x)\\
Q(x)+(-x+2A(x))P(x)+x=R(x)\\
$
***
考虑在已经知道$R(x)$,$Q(x)$,$A(x)$的前$n-1$项时如何计算第$n$项.
首先可以直接根据定义计算出$q_n$.
江$x=n$带入上式:
$
q_n-p_{n-1}+2\sum_{i=0}^na_ip_{n-i}=r_n\\
q_n-na_n-p_{n-1}+2\sum_{i=0}^{n-1}a_ip_{n-i}=0\\
na_n=q_n-p_{n-1}+2\sum_{i=0}^{n-1}a_ip_{n-i}\\
$
至此,获得一个$O(n^2)$的做法.
这个做法可以通过分块fft优化卷积使得复杂度达到$O((nlogn)^{1.5})$,可以通过本题.